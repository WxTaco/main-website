name: Sync back to monorepo

on:
  push:
    branches: [ main ]   # run when changes hit main

# Keep least privilege and avoid duplicate runs
permissions:
  contents: read

concurrency:
  group: sync-to-monorepo-${{ github.ref }}
  cancel-in-progress: true

jobs:
  sync-to-monorepo:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout website repo
        uses: actions/checkout@v4

      - name: Checkout monorepo
        uses: actions/checkout@v4
        with:
          repository: WxTaco/wrapped
          token: ${{ secrets.MONOREPO_TOKEN }}   # PAT with access to wrapped
          path: wrapped

      - name: Sync website into monorepo
        run: |
          set -euo pipefail
          mkdir -p ./wrapped/main-web
          rsync -av --delete \
            --exclude='.git/' \
            ./ ./wrapped/main-web/

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.MONOREPO_TOKEN }}
          path: wrapped
          branch: sync/main-website-to-monorepo
          commit-message: "Sync main-website changes into monorepo (main-web/)"
          title: "Sync main-website changes into monorepo"
          body: |
            This PR syncs the latest changes from **WxTaco/main-website** into the `main-web/` folder of **WxTaco/wrapped**.

            - Source repo: WxTaco/main-website
            - Target folder: `main-web/`

            Triggered automatically by GitHub Actions.
          labels: sync, automated
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.MONOREPO_TOKEN }}
          path: wrapped
          branch: sync/main-website-to-monorepo
          commit-message: "Sync main-website changes into monorepo (main-web/)"
          title: "Sync main-website changes into monorepo"
          body: |
            This PR syncs the latest changes from **WxTaco/main-website** into the `main-web/` folder of **WxTaco/wrapped**.

            - Source repo: WxTaco/main-website
            - Target folder: `main-web/`

            Triggered automatically by GitHub Actions.
          labels: sync, automated      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.MONOREPO_TOKEN }}
          path: wrapped
          branch: sync/main-website-to-monorepo
          commit-message: "Sync main-website changes into monorepo (main-web/)"
          title: "Sync main-website changes into monorepo"
          body: |
            This PR syncs the latest changes from **WxTaco/main-website** into the `main-web/` folder of **WxTaco/wrapped**.

            - Source repo: WxTaco/main-website
            - Target folder: `main-web/`

            Triggered automatically by GitHub Actions.
          labels: sync, automated
