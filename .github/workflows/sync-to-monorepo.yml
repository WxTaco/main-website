name: Sync back to monorepo

on:
  push:
    branches: [ main ]   # run when changes hit main

jobs:
  sync-to-monorepo:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout website repo
        uses: actions/checkout@v4

      - name: Clone monorepo
        run: |
          git clone https://x-access-token:${{ secrets.MONOREPO_TOKEN }}@github.com/WxTaco/wrapped.git ../wrapped
          rsync -av --delete ./ ../wrapped/main-web/
        shell: bash

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.MONOREPO_TOKEN }}
          path: ../wrapped
          branch: sync/main-website-to-monorepo
          commit-message: "Sync main-website changes into monorepo (main-web/)"
          title: "Sync main-website changes into monorepo"
          body: |
            This PR syncs the latest changes from **WxTaco/main-website** into the `main-web/` folder of **WxTaco/wrapped**.
            
            - Source repo: WxTaco/main-website
            - Target folder: `main-web/`
            
            Triggered automatically by GitHub Actions.
          labels: sync, automated
